# 正则表达式搜索

本章介绍如何在MySQL `WHERE`子句内使用正则表达式(RE)来更好地控制数据过滤。


<br/>
<br/>


## 正则表达式介绍

正则表达式用来匹配文本的特殊的串(字符集)。
所有种类的程序设计语言、文本编辑器、操作系统...都支持正则表达式。
正则表达式用正则表达式语言来建立，它是一种特殊语言。


<br/>
<br/>


## MySQL正则表达式

MySQL用`WHERE`子句中的`REGEXP`关键字对正则表达式提供了初步的支持。
MySQL中的正则表达式默认不缺分大小写；如果要区分，可使用`BINARY`关键字。


<br/>


### 基本字符匹配

```sql
SELECT name
FROM table1
WHERE score REGEXP '100';

# 这里使用的正则效果还没有LIKE好，因为它并不复杂，这里仅做栗子参考


-- 下面看一个复杂点的
-- 特殊字符.表示匹配任意一个字符
SELECT score
FROM table1
WHERE socre REGEXP '.0'

```


<br/>
<br/>


### OR匹配

使用`|`进行或匹配。

```sql
SELECT name
FROM table1
WHERE name REGEXP '111|222|333';

```


<br/>
<br/>


### 匹配多个字符之一

利用一组括号`[]`来完成。

```sql
SELECT name
FROM table1
WHERE name REGEXP '[zhang|li|song]';

```


<br/>
<br/>


### 匹配范围

集合可用来定义要匹配的一个或多个字符。

```sql
/*
[0123456789]
[0-9]
[a-z]
[a-zA-Z]
*/

SELECT name
FROM table1
WHERE name REGEXP '[a-zA-z]hang';

```

<br/>
<br/>


### 转义字符

MySQL中的正则表达式使用两个反斜线(`\\`)做转义。

```sql
SELECT score
FROM table1
WHERE score  REGEXP '[8|9]0\\.0';

```


<br/>
<br/>


### 匹配字符类

为了更方便的工作，可以使用预定义的字符集，称为**字符类(character class)**。

| 类 | 说明 |
| - | - |
| `[:alnum:]`  | 任意字母和数字（同`[a-zA-Z0-9]`） |
| `[:alpha:]` | 任意字符（同[a-zA-Z]） |
| `[:blank:]` | 空格和制表（同[\\t]） |
| `[:cntrl:]` | ASCII控制字符（ASCII 0到31和127） |
| `[:digit:]` | 任意数字（同[0-9]） |
| `[:graph:]` | 与[:print:]相同，但不包括空格 |
| `[:lower:]` | 任意小写字母（同[a-z]） |
| `[:print:]` | 任意可打印字符 |
| `[:punct:]` | 既不在[:alnum:]又不在[:cntrl:]中的任意字符 |
| `[:space:]` | 包括空格在内的任意空白字符（同[\\f\\n\\r\\t\\v]） |
| `[:upper:]` | 任意大写字母（同[A-Z]） |
| `[:xdigit:]` | 任意十六进制数字（同[a-fA-F0-9]） |


<br/>
<br/>


### 匹配多个实例

重复元字符:

| 元字符 | 说明 |
| - | - |
| `*` | 0个或多个匹配 |
| `+` | 1个或多个匹配（等于{1,}） |
| `?` | 0个或1个匹配（等于{0,1}） |
| `{n}` | 指定数目的匹配 |
| `{n,}` | 不少于指定数目的匹配 |
| `{n,m}` |  匹配数目的范围（m不超过255 |

```sql
SELECT name
FROM table1
WHERE name REGEXP '\\([0-9] zhang?\\)';

```


<br/>
<br/>


### 定位符

匹配特定位置的文本。

| 元字符 | 说明 |
| - | - |
| `^` | 文本的开始 |
| `$` | 文本的结尾 |
| `[[:<:]]` | 词的开始 |
| `[[:>:]]` | 词的结尾 |

```sql
SELECT name
FROM table1
WHERE name REGEXP '^[0-9\\.]';

```
